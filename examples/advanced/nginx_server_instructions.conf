# Server Block Instructions Example
# This file contains NGINX directives that will be inserted into the server {} block
# of the CloudGuard WAF AppSec Gateway configuration

# SSL/TLS Configuration
ssl_protocols TLSv1.2 TLSv1.3;
ssl_prefer_server_ciphers on;
ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;

# Client Body and Header Size Limits
client_max_body_size 100m;
client_body_buffer_size 128k;
client_header_buffer_size 4k;
large_client_header_buffers 4 16k;

# Timeouts
client_body_timeout 120s;
client_header_timeout 120s;
send_timeout 120s;

# Security Headers (applied at server level)
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Enable compression at server level
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss application/rss+xml font/truetype font/opentype application/vnd.ms-fontobject image/svg+xml;

# Server-level rate limiting zone definition
limit_req_zone $binary_remote_addr zone=server_limit:10m rate=10r/s;

# Custom error pages
error_page 500 502 503 504 /50x.html;
location = /50x.html {
    root /usr/share/nginx/html;
    internal;
}

# Deny access to hidden files at server level
location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
}
